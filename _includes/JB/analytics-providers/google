<!-- Google tag (gtag.js) -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.JB.analytics.google.tracking_id }}"></script>
<script>
  // Reads the value of a cookie by name or returns empty string
  function getCookie(name) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + name + '\\s*=\\s*([^;]+)');
    return b ? b.pop() : '';
  }

  // Actually starting analytics up
  function addAnalytics() {
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', '{{ site.JB.analytics.google.tracking_id }}');
  }

  // Waiting for the load event
  window.addEventListener("load", function () {
    // Reading "cookieconsent_status" cookie
    const cookieConsent = getCookie('cookieconsent_status');

    // Start analytics ONLY if user explicitly consented
    if (cookieConsent === 'allow') {
      addAnalytics();
    }

    // Initialise cookie consent banner
    window.cookieconsent.initialise({
      palette: {
        popup: {
          background: "#efefef",
          text: "#404040"
        },
        button: {
          background: "#8ec760",
          text: "#ffffff"
        }
      },
      type: "opt-in",
      content: {
        message: "This website uses cookies to ensure you get the best experience and to enable analytics.",
        allow: "Accept cookies",
        deny: "Decline",
        link: "Learn more",
        policy: "Cookie Policy"
      },
      onStatusChange: function (status, chosenBefore) {
        location.reload();
      }
    });
  });
</script>
